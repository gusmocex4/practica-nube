secrets:
  db_user_passwd:
    file: ./db_user_passwd
  c-nube-lab_secret_key:
    file: ./c-nube-lab_secret_key
services:
  postgres-db:
    image: 'postgres:16.0-alpine'
    restart: always
    deploy:
      replicas: 1
    environment:
    POSTGRES_DB: geral
    POSTGRES_USER: tiapa
    POSTGRES_PASSWORD: tiapa
    volumes:
      - postgres_data:/var/lib/postgresql/data
    secrets:
      - db_user_passwd
    networks:
      - c-nube-lab_net
    healthcheck:
    test: ["CMD", "pg_isready"]
    start_period: 30s
c-nube-lab:
  image: gusmocex4/c-nube-lab:1.0
  restart: always
  deploy:
    replicas: 1
  ports:
    - 8000:3000
  environment:
# Variables de conexi√≥n que la API lee del entorno
    DB_HOST: postgres-db # Usa el nombre del servicio como host
    DB_USER: tiapa
    DB_PASSWORD: tiapa
    DB_NAME: geral
    SECRET_KEY: "tu_clave_secreta_jwt_o_auth"
  secrets:
    - c-nube-lab_secret_key
  networks:
    - c-nube-lab_net
volumes:
  postgres_data:
    driver: local
    driver_opts:
  type: "nfs"
  o: "addr=nfssrv01,rw"
  device: ":/data/docker-vols/group02/postgres_data"
networks:
  c-nube-lab_net:
    driver: overlay
